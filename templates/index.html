<!DOCTYPE html>
<html>
<head>
    <title>ClimateSense AI</title>
    <link rel="icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <button class="mobile-menu-btn" id="mobile-menu-btn">â˜°</button>
    
    <div class="theme-toggle" id="theme-toggle">
        <svg id="light-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 2V4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 20V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M4.93 4.93L6.34 6.34" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M17.66 17.66L19.07 19.07" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M2 12H4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M20 12H22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M6.34 17.66L4.93 19.07" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M19.07 4.93L17.66 6.34" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <svg id="dark-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: none;">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </div>
    
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button class="new-chat-btn" onclick="newChat()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 4V20M4 12H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                New chat
            </button>
            <button class="ipcc-crawler-btn" onclick="startIPCCCrawler()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 19C15.866 19 19 15.866 19 12C19 8.13401 15.866 5 12 5C8.13401 5 5 8.13401 5 12C5 15.866 8.13401 19 12 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 9V12L14.5 13.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M16 5V3M19 6L17 4M21 12H19M19 19L17 17M12 21V19M7 17L5 19M3 12H5M7 7L5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                IPCC Crawler
            </button>
        </div>
        
        <div class="sidebar-nav">
            <div class="chat-history">
                <div class="chat-item active">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Climate Discussion</span>
                </div>
                <div class="chat-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>IPCC Analysis</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="main-content">
        <div class="chat-header">
            <div class="chat-title">ClimateSense AI</div>
        </div>
        
        <div class="chat-container" id="chat-container">
            <!-- Welcome screen -->
            <div class="welcome-container" id="welcome-container">
                <h1 class="welcome-title">ClimateSense AI Assistant</h1>
                <p class="welcome-subtitle">Your AI-powered assistant for IPCC summaries, climate data analysis, and environmental insights.</p>
                
                <div class="features-grid">
                    <div class="feature-card">
                        <h3>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="#10a37f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Climate Analysis
                        </h3>
                        <p>Get detailed analysis of climate patterns, temperature trends, and environmental changes.</p>
                    </div>
                    
                    <div class="feature-card">
                        <h3>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3 15C3 17.8284 3 19.2426 3.87868 20.1213C4.75736 21 6.17157 21 9 21H15C17.8284 21 19.2426 21 20.1213 20.1213C21 19.2426 21 17.8284 21 15M3 15C3 12.1716 3 10.7574 3.87868 9.87868C4.75736 9 6.17157 9 9 9H15C17.8284 9 19.2426 9 20.1213 9.87868C21 10.7574 21 12.1716 21 15M3 15V9M21 15V9" stroke="#10a37f" stroke-width="2" stroke-linecap="round"/>
                                <path d="M9 8L9 5C9 4.44772 9.44772 4 10 4H14C14.5523 4 15 4.44772 15 5V8" stroke="#10a37f" stroke-width="2" stroke-linecap="round"/>
                                <circle cx="12" cy="15" r="1" fill="#10a37f"/>
                            </svg>
                            Data Reports
                        </h3>
                        <p>Access comprehensive reports on carbon emissions, sea levels, and biodiversity metrics.</p>
                    </div>
                    
                    <div class="feature-card">
                        <h3>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9 20H15M9 20C6.19974 17.33 4.66388 14.1335 4.24974 12.0001C3.99966 10.7051 3.99966 9.29487 4.24974 7.99989C5.32278 5.91233 7.9136 4 12 4C16.0864 4 18.6772 5.91233 19.7503 7.99989C20.0003 9.29487 20.0003 10.7051 19.7503 12.0001C19.3361 14.1335 17.8003 17.33 15 20M9 20C9.33333 19 10.8 15.8 14 15.5M15 20C14.6667 19 13.2 15.8 10 15.5" stroke="#10a37f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Predictions
                        </h3>
                        <p>Receive AI-powered predictions on future climate scenarios and environmental impacts.</p>
                    </div>
                    
                    <div class="feature-card">
                        <h3>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M19 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H19C20.1046 21 21 20.1046 21 19V5C21 3.89543 20.1046 3 19 3Z" stroke="#10a37f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M9 10C9.55228 10 10 9.55228 10 9C10 8.44772 9.55228 8 9 8C8.44772 8 8 8.44772 8 9C8 9.55228 8.44772 10 9 10Z" stroke="#10a37f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M19 14L14 9L5 18" stroke="#10a37f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            IPCC Summarizer
                        </h3>
                        <p>Get concise summaries of IPCC reports and key findings on climate change.</p>
                    </div>
                </div>
                
                <div class="input-container" style="max-width: 600px;">
                    <div class="input-area">
                        <textarea 
                            id="welcome-input" 
                            placeholder="Ask about IPCC reports, climate data, or predictions..." 
                            rows="1"
                        ></textarea>
                        <button onclick="sendMessageFromWelcome()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22 2L11 13M22 2L15 22L11 13L2 9L22 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                    <div class="input-footer">
                        IPCC data is sourced from official reports. ClimateSense AI can make mistakes.
                    </div>
                </div>
            </div>
            
            <!-- Messages will be added here dynamically -->
        </div>
        
        <div class="input-container" id="input-container" style="display: none;">
            <div class="input-area">
                <textarea 
                    id="message-input" 
                    placeholder="Message ClimateSense AI..." 
                    rows="1"
                    oninput="autoResize(this)"
                    onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); }"
                ></textarea>
                <div class="ipcc-crawler-chat-btn" title="Run IPCC Crawler" onclick="startIPCCCrawler()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 19C15.866 19 19 15.866 19 12C19 8.13401 15.866 5 12 5C8.13401 5 5 8.13401 5 12C5 15.866 8.13401 19 12 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 9V12L14.5 13.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M16 5V3M19 6L17 4M21 12H19M19 19L17 17M12 21V19M7 17L5 19M3 12H5M7 7L5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <button id="send-button" onclick="sendMessage()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22 2L11 13M22 2L15 22L11 13L2 9L22 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div class="input-footer">
                IPCC data is sourced from official reports. ClimateSense AI can make mistakes.
            </div>
        </div>
    </div>

    <script>
        // Mobile menu toggle
        document.getElementById('mobile-menu-btn').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('open');
        });
        
        // Theme toggle
        const themeToggle = document.getElementById('theme-toggle');
        const lightIcon = document.getElementById('light-icon');
        const darkIcon = document.getElementById('dark-icon');
        
        // Check for saved theme preference
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            lightIcon.style.display = 'none';
            darkIcon.style.display = 'block';
        } else {
            lightIcon.style.display = 'block';
            darkIcon.style.display = 'none';
        }
        
        themeToggle.addEventListener('click', function() {
            document.body.classList.toggle('dark-mode');
            
            if (document.body.classList.contains('dark-mode')) {
                lightIcon.style.display = 'none';
                darkIcon.style.display = 'block';
                localStorage.setItem('theme', 'dark');
            } else {
                lightIcon.style.display = 'block';
                darkIcon.style.display = 'none';
                localStorage.setItem('theme', 'light');
            }
        });
        
        // Auto-resize textarea
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
            
            if (textarea.scrollHeight > 200) {
                textarea.style.overflowY = 'auto';
            } else {
                textarea.style.overflowY = 'hidden';
            }
        }
        
        // Scroll to bottom of chat
        function scrollToBottom() {
            const container = document.getElementById('chat-container');
            container.scrollTop = container.scrollHeight;
        }
        
        // Add message to chat
        function addMessage(sender, text) {
            // Hide welcome screen if visible
            const welcomeContainer = document.getElementById('welcome-container');
            if (welcomeContainer) {
                welcomeContainer.style.display = 'none';
                document.getElementById('input-container').style.display = 'block';
            }
            
            const container = document.getElementById('chat-container');
            const timestamp = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.innerHTML = `
                <div class="avatar">${sender === 'user' ? 'Y' : 'C'}</div>
                <div class="message-content">
                    <div class="sender">${sender === 'user' ? 'You' : 'ClimateSense AI'}</div>
                    <div class="message-text">${text}</div>
                </div>
            `;
            
            container.appendChild(messageDiv);
            scrollToBottom();
        }
        
        // Send message from welcome screen
        function sendMessageFromWelcome() {
            const input = document.getElementById('welcome-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessage('user', message);
            input.value = '';
            
            // Simulate AI response
            setTimeout(() => {
                addMessage('ai', "Hello! I'm ClimateSense AI, your assistant for IPCC summaries and climate data analysis. How can I help you today?");
            }, 1000);
        }
        
        // Send message to backend
        async function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            const button = document.getElementById('send-button');
            
            if (!message) return;
            
            // Disable input during processing
            input.disabled = true;
            button.disabled = true;
            
            // Add user message to chat
            addMessage('user', message);
            input.value = '';
            input.style.height = 'auto';
            
            try {
                // Send to backend
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ message })
                });
                
                if (!response.ok) {
                    throw new Error('Server error');
                }
                
                const data = await response.json();
                
                // Add AI response to chat
                addMessage('ai', data.response);
            } catch (error) {
                addMessage('ai', 'Sorry, I encountered an error. Please try again.');
                console.error('Error:', error);
            } finally {
                // Re-enable input
                input.disabled = false;
                button.disabled = false;
                input.focus();
            }
        }
        
        // Start IPCC crawler
        async function startIPCCCrawler() {
            try {
                const response = await fetch('/crawl-ipcc', {
                    method: 'POST'
                });
                const result = await response.json();
                addMessage('ai', `IPCC crawler started: ${result.status}. This may take a few minutes...`);
            } catch (error) {
                addMessage('ai', 'Failed to start IPCC crawler.');
                console.error('Error:', error);
            }
        }
        
        // Start a new chat
        function newChat() {
            document.getElementById('chat-container').innerHTML = '';
            document.getElementById('welcome-container').style.display = 'flex';
            document.getElementById('input-container').style.display = 'none';
        }
        
        // Initialize textarea auto-resize
        const textareas = document.querySelectorAll('textarea');
        textareas.forEach(textarea => {
            textarea.addEventListener('input', function() {
                autoResize(this);
            });
        });
    </script>
</body>
</html>
